<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Inventory Manager</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #eee; }
    input[type="text"], input[type="number"] { padding: 5px; width: 100%; box-sizing: border-box; }
    button { padding: 8px 12px; margin: 4px; cursor: pointer; }
    #passwordPrompt { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                      background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    #passwordPrompt div { background: #fff; padding: 20px; border-radius: 5px; text-align: center; }
  </style>
</head>
<body>
  <h1>Live Inventory Manager</h1>

  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="inventoryTable"></tbody>
  </table>

  <h3>Add New Item</h3>
  <input type="text" id="newItemName" placeholder="Item Name">
  <input type="number" id="newItemQty" placeholder="Quantity">
  <input type="number" id="newItemPrice" placeholder="Price">
  <button onclick="addItem()">Add Item</button>

  <h3>Total Money Earned: $<span id="totalMoney">0</span></h3>
  <button onclick="promptPassword()">Clear Sales History</button>

  <!-- Password Prompt -->
  <div id="passwordPrompt">
    <div>
      <p>Enter password to clear sales history:</p>
      <input type="password" id="passwordInput">
      <br><br>
      <button onclick="checkPassword()">Submit</button>
      <button onclick="closePasswordPrompt()">Cancel</button>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    // ====== FIREBASE CONFIG ======
    const firebaseConfig = {
  apiKey: "AIzaSyDVx0tGc83eDFADyB335sJhFnVVBCYP6KE",
  authDomain: "livesync-64c2e.firebaseapp.com",
  projectId: "livesync-64c2e",
  storageBucket: "livesync-64c2e.firebasestorage.app",
  messagingSenderId: "781322311897",
  appId: "1:781322311897:web:4aed3572f846a1d46e46c8"
};


    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const inventoryRef = db.ref("inventory");
    const salesRef = db.ref("sales");

    // ====== LOAD INVENTORY ======
    inventoryRef.on("value", snapshot => {
      const table = document.getElementById("inventoryTable");
      table.innerHTML = "";
      snapshot.forEach(itemSnap => {
        const item = itemSnap.val();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.name}</td>
          <td>${item.quantity}</td>
          <td>$${item.price}</td>
          <td>
            <button onclick="sellItem('${itemSnap.key}')">Sell 1</button>
            <button onclick="deleteItem('${itemSnap.key}')">Delete</button>
          </td>
        `;
        table.appendChild(tr);
      });
    });

    // ====== TOTAL MONEY ======
    salesRef.on("value", snapshot => {
      let total = 0;
      snapshot.forEach(snap => {
        total += snap.val().amount;
      });
      document.getElementById("totalMoney").innerText = total.toFixed(2);
    });

    // ====== ADD ITEM ======
    function addItem() {
      const name = document.getElementById("newItemName").value.trim();
      const quantity = parseInt(document.getElementById("newItemQty").value);
      const price = parseFloat(document.getElementById("newItemPrice").value);
      if (!name || isNaN(quantity) || isNaN(price)) return alert("Please fill all fields correctly.");
      inventoryRef.push({ name, quantity, price });
      document.getElementById("newItemName").value = "";
      document.getElementById("newItemQty").value = "";
      document.getElementById("newItemPrice").value = "";
    }

    // ====== SELL ITEM ======
    function sellItem(key) {
      const itemRef = inventoryRef.child(key);
      itemRef.once("value").then(snap => {
        const item = snap.val();
        if (item.quantity <= 0) return alert("Item out of stock!");
        itemRef.update({ quantity: item.quantity - 1 });
        salesRef.push({ name: item.name, amount: item.price, timestamp: Date.now() });
      });
    }

    // ====== DELETE ITEM ======
    function deleteItem(key) {
      if (confirm("Are you sure you want to delete this item?")) {
        inventoryRef.child(key).remove();
      }
    }

    // ====== PASSWORD PROTECTED CLEAR SALES ======
    function promptPassword() {
      document.getElementById("passwordPrompt").style.display = "flex";
    }

    function closePasswordPrompt() {
      document.getElementById("passwordPrompt").style.display = "none";
      document.getElementById("passwordInput").value = "";
    }

    function checkPassword() {
      const input = document.getElementById("passwordInput").value;
      if (input === "2025") {
        if (confirm("Are you sure you want to clear all sales history?")) {
          salesRef.remove();
        }
        closePasswordPrompt();
      } else {
        alert("Incorrect password!");
      }
    }
  </script>
</body>
</html>
